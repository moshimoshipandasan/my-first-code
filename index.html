<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>my-first-code 掲示板ログ</title>
    <meta
      name="description"
      content="GitHub Issues を掲示板ログとして表示します。投稿は GitHub Issue 画面から行ってください。"
    />
    <style>
      :root {
        color-scheme: light dark;
        --bg: #f7f7f9;
        --fg: #1f1f1f;
        --card-bg: #ffffff;
        --accent: #0f62fe;
        --border: rgba(0, 0, 0, 0.12);
        --muted: rgba(0, 0, 0, 0.6);
        --palette-bb1-bg: #ffe5ec;
        --palette-bb1-accent: #ff4d6d;
        --palette-bbs2-bg: #e0f4ff;
        --palette-bbs2-accent: #0096c7;
        --palette-bbs3-bg: #e6f9f2;
        --palette-bbs3-accent: #2bbbad;
        --palette-shadow: 0 18px 35px rgba(31, 31, 31, 0.1);
      }

      @media (prefers-color-scheme: dark) {
        :root {
          --bg: #0f1117;
          --fg: #e6e6ea;
          --card-bg: #181b23;
          --border: rgba(255, 255, 255, 0.12);
          --muted: rgba(255, 255, 255, 0.6);
          --palette-bb1-bg: #42283a;
          --palette-bb1-accent: #ff7990;
          --palette-bbs2-bg: #183449;
          --palette-bbs2-accent: #4dc0ff;
          --palette-bbs3-bg: #1d3d31;
          --palette-bbs3-accent: #4ce0b3;
          --palette-shadow: 0 22px 40px rgba(0, 0, 0, 0.4);
        }
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        font-family: "Segoe UI", "Hiragino Kaku Gothic ProN", "BIZ UDPGothic",
          sans-serif;
        background: var(--bg);
        color: var(--fg);
        line-height: 1.6;
      }

      a {
        color: var(--accent);
        text-decoration: none;
      }

      a:hover,
      a:focus-visible {
        text-decoration: underline;
      }

      header {
        padding: 1.5rem 1rem 1rem;
      }

      main {
        width: min(960px, 100%);
        margin: 0 auto;
        padding: 0 1rem 2.5rem;
      }

      .headline {
        margin: 0 0 0.5rem;
        font-size: clamp(1.5rem, 4vw, 2.25rem);
        font-weight: 700;
      }

      .lede {
        margin: 0 0 1rem;
        color: var(--muted);
        font-size: 0.95rem;
      }

      .actions {
        display: flex;
        flex-wrap: wrap;
        gap: 0.75rem;
        margin-bottom: 1.5rem;
      }

      .primary-button,
      .secondary-button {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        padding: 0.75rem 1rem;
        border-radius: 0.75rem;
        font-weight: 600;
        font-size: 0.95rem;
        border: 1px solid transparent;
        cursor: pointer;
        transition: transform 0.15s ease, box-shadow 0.15s ease,
          border-color 0.15s ease;
      }

      .primary-button {
        background: var(--accent);
        color: #ffffff;
      }

      .primary-button:hover,
      .primary-button:focus-visible {
        transform: translateY(-1px);
        box-shadow: 0 8px 20px rgba(15, 98, 254, 0.2);
      }

      .secondary-button {
        background: var(--card-bg);
        border-color: var(--border);
        color: inherit;
      }

      .secondary-button:hover,
      .secondary-button:focus-visible {
        transform: translateY(-1px);
        border-color: var(--accent);
      }

      .status-bar {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        color: var(--muted);
        font-size: 0.85rem;
        margin-bottom: 1.5rem;
        min-height: 1.25rem;
      }

      .palette-board {
        display: grid;
        gap: 1.5rem;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      }

      .palette-column {
        position: relative;
        padding: 1.5rem 1.35rem 1.4rem;
        border-radius: 1.25rem;
        overflow: hidden;
        box-shadow: var(--palette-shadow);
        display: flex;
        flex-direction: column;
        gap: 1.1rem;
        min-height: 320px;
        border: 1px solid var(--border);
        background: var(--card-bg);
      }

      .palette-column::before {
        content: "";
        position: absolute;
        inset: 0;
        opacity: 0.6;
        pointer-events: none;
        transition: opacity 0.3s ease;
      }

      .palette-column:hover::before {
        opacity: 0.75;
      }

      .palette-column--bb1::before {
        background: radial-gradient(circle at 20% 20%, rgba(255, 77, 109, 0.35), transparent 70%),
          linear-gradient(135deg, var(--palette-bb1-bg), rgba(255, 255, 255, 0.85));
      }

      .palette-column--bbs2::before {
        background: radial-gradient(circle at 80% 10%, rgba(0, 150, 199, 0.35), transparent 70%),
          linear-gradient(135deg, var(--palette-bbs2-bg), rgba(255, 255, 255, 0.85));
      }

      .palette-column--bbs3::before {
        background: radial-gradient(circle at 15% 80%, rgba(43, 187, 173, 0.35), transparent 70%),
          linear-gradient(135deg, var(--palette-bbs3-bg), rgba(255, 255, 255, 0.85));
      }

      .palette-column--other::before {
        background: linear-gradient(135deg, rgba(128, 128, 128, 0.25), rgba(255, 255, 255, 0.85));
      }

      .palette-column-header {
        display: flex;
        align-items: baseline;
        justify-content: space-between;
        gap: 0.75rem;
        position: relative;
        z-index: 1;
      }

      .palette-column-header > div {
        display: flex;
        flex-direction: column;
        gap: 0.25rem;
      }

      .palette-column-title {
        margin: 0;
        font-size: 1.15rem;
        font-weight: 700;
        letter-spacing: 0.05em;
        text-transform: uppercase;
      }

      .palette-column-caption {
        margin: 0;
        font-size: 0.75rem;
        color: var(--muted);
        letter-spacing: 0.08em;
        text-transform: uppercase;
      }

      .palette-column-count {
        font-size: 0.8rem;
        color: var(--muted);
        letter-spacing: 0.08em;
      }

      .palette-column-body {
        display: flex;
        flex-direction: column;
        gap: 0.9rem;
        position: relative;
        z-index: 1;
      }

      .palette-column-empty {
        margin-top: 0.75rem;
        font-size: 0.9rem;
        color: var(--muted);
        text-align: center;
      }

      .issue-card {
        background: rgba(255, 255, 255, 0.92);
        border-radius: 1rem;
        border: 1px solid rgba(255, 255, 255, 0.6);
        padding: 1.05rem 1.2rem;
        display: flex;
        flex-direction: column;
        gap: 0.65rem;
        box-shadow: none;
        backdrop-filter: blur(6px);
        transition: transform 0.2s ease, box-shadow 0.2s ease, border 0.2s ease;
        color: #1f1f1f;
      }

      .issue-card:hover,
      .issue-card:focus-within {
        transform: translateY(-3px);
        box-shadow: 0 12px 24px rgba(31, 31, 31, 0.18);
        border-color: rgba(15, 17, 23, 0.12);
      }

      .issue-title {
        margin: 0;
        font-size: 1.02rem;
        font-weight: 680;
        line-height: 1.35;
      }

      .issue-title a {
        color: inherit;
      }

      .issue-meta {
        display: flex;
        flex-wrap: wrap;
        gap: 0.45rem 0.9rem;
        font-size: 0.82rem;
        color: rgba(31, 31, 31, 0.7);
        letter-spacing: 0.02em;
      }

      .issue-body {
        margin: 0;
        font-size: 0.92rem;
        white-space: pre-wrap;
        word-break: break-word;
        line-height: 1.7;
      }

      .labels {
        display: flex;
        flex-wrap: wrap;
        gap: 0.35rem;
      }

      .label-pill {
        display: inline-flex;
        align-items: center;
        padding: 0.18rem 0.6rem;
        border-radius: 999px;
        font-size: 0.7rem;
        font-weight: 600;
        letter-spacing: 0.05em;
        background: rgba(31, 31, 31, 0.08);
        color: #1f1f1f;
      }

      .label-pill--primary {
        background: rgba(31, 31, 31, 0.2);
      }

      @media (prefers-color-scheme: dark) {
        .palette-column {
          border-color: rgba(255, 255, 255, 0.08);
        }

        .palette-column::before {
          opacity: 0.55;
        }

        .palette-column:hover::before {
          opacity: 0.7;
        }

        .issue-card {
          background: rgba(24, 27, 35, 0.85);
          border-color: rgba(255, 255, 255, 0.12);
          color: #e6e6ea;
        }

        .issue-card:hover,
        .issue-card:focus-within {
          border-color: rgba(255, 255, 255, 0.2);
          box-shadow: 0 18px 30px rgba(0, 0, 0, 0.45);
        }

        .issue-meta {
          color: rgba(230, 230, 234, 0.7);
        }

        .label-pill {
          background: rgba(230, 230, 234, 0.15);
          color: #e6e6ea;
        }

        .label-pill--primary {
          background: rgba(230, 230, 234, 0.3);
        }

        .palette-column-caption {
          color: rgba(230, 230, 234, 0.7);
        }
      }

      .empty-state {
        text-align: center;
        color: var(--muted);
        font-size: 0.95rem;
        padding: 1.5rem 0;
      }

      footer {
        padding: 2rem 1rem 3rem;
        text-align: center;
        font-size: 0.8rem;
        color: var(--muted);
      }
    </style>
  </head>
  <body>
    <header>
      <h1 class="headline">my-first-code 掲示板ログ</h1>
      <p class="lede">
        このページは GitHub Issues を掲示板ログとして表示します。投稿するときは
        GitHub の Issue 画面から行ってください。
      </p>
      <div class="actions">
        <a
          class="primary-button"
          target="_blank"
          rel="noopener noreferrer"
          href="https://github.com/moshimoshipandasan/my-first-code/issues/new"
        >
          Issue を投稿する
        </a>
        <button class="secondary-button" type="button" id="refreshButton">
          最新のログを読み込む
        </button>
      </div>
    </header>
    <main>
      <div class="status-bar" id="statusBar">読み込み中...</div>
      <section class="palette-board" id="issuesGrid" aria-live="polite"></section>
      <div class="empty-state" id="emptyState" hidden>
        まだ Issue はありません。上の「Issue を投稿する」ボタンから最初の投稿をしてみましょう。
      </div>
    </main>
    <footer>
      更新は GitHub API（60 リクエスト/時）に依存します。アクセスが集中すると読み込みに時間がかかる場合があります。
    </footer>
    <script>
      const repoOwner = "moshimoshipandasan";
      const repoName = "my-first-code";
      const issuesGrid = document.getElementById("issuesGrid");
      const statusBar = document.getElementById("statusBar");
      const emptyState = document.getElementById("emptyState");
      const refreshButton = document.getElementById("refreshButton");

      const formatDate = (isoString) => {
        const date = new Date(isoString);
        if (Number.isNaN(date.getTime())) return "日時不明";
        return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(
          2,
          "0"
        )}-${String(date.getDate()).padStart(2, "0")} ${String(
          date.getHours()
        ).padStart(2, "0")}:${String(date.getMinutes()).padStart(2, "0")}`;
      };

      const stateBadge = (state) => {
        if (state === "open") return "公開中";
        if (state === "closed") return "クローズ済み";
        return state;
      };

      const clearIssues = () => {
        while (issuesGrid.firstChild) {
          issuesGrid.removeChild(issuesGrid.firstChild);
        }
      };

      const renderIssues = (issues) => {
        clearIssues();
        if (!Array.isArray(issues) || issues.length === 0) {
          emptyState.hidden = false;
          return;
        }
        emptyState.hidden = true;

        const paletteColumns = [
          { key: "bb1", title: "BB1", caption: "タグ: bb1" },
          { key: "bbs2", title: "BBS2", caption: "タグ: bbs2" },
          { key: "bbs3", title: "BBS3", caption: "タグ: bbs3" },
        ];

        const groups = { other: [] };
        paletteColumns.forEach(({ key }) => {
          groups[key] = [];
        });

        const normalizeLabel = (label) => {
          if (typeof label === "string") return label;
          if (label && typeof label.name === "string") return label.name;
          return "";
        };

        issues.forEach((issue) => {
          const labelNames = Array.isArray(issue.labels)
            ? issue.labels
                .map((label) => normalizeLabel(label).trim())
                .filter((name) => name.length > 0)
            : [];

          const normalized = labelNames.map((name) => name.toLowerCase());
          const matchedColumn = paletteColumns.find((column) =>
            normalized.includes(column.key)
          );
          const bucketKey = matchedColumn ? matchedColumn.key : "other";

          groups[bucketKey].push({ issue, labelNames, bucketKey });
        });

        issuesGrid.innerHTML = "";

        const createIssueCard = ({ issue, labelNames, bucketKey }) => {
          const card = document.createElement("article");
          card.className = "issue-card";

          const title = document.createElement("h2");
          title.className = "issue-title";
          const titleLink = document.createElement("a");
          titleLink.href = issue.html_url;
          titleLink.target = "_blank";
          titleLink.rel = "noopener noreferrer";
          titleLink.textContent = `#${issue.number} ${issue.title}`;
          title.appendChild(titleLink);

          const meta = document.createElement("div");
          meta.className = "issue-meta";
          meta.innerHTML = `
            <span>${stateBadge(issue.state)}</span>
            <span>作成: ${issue.user?.login ?? "不明"}</span>
            <span>更新: ${formatDate(issue.updated_at)}</span>
            <span>コメント: ${issue.comments}</span>
          `;

          card.appendChild(title);
          card.appendChild(meta);

          if (labelNames.length) {
            const labelsWrapper = document.createElement("div");
            labelsWrapper.className = "labels";
            labelNames.forEach((name) => {
              const pill = document.createElement("span");
              const isPrimary = name.toLowerCase() === bucketKey.toLowerCase();
              pill.className = `label-pill${
                isPrimary ? " label-pill--primary" : ""
              }`;
              pill.textContent = name;
              labelsWrapper.appendChild(pill);
            });
            card.appendChild(labelsWrapper);
          }

          if (issue.body) {
            const body = document.createElement("p");
            body.className = "issue-body";
            body.textContent = issue.body ?? "";
            card.appendChild(body);
          }

          return card;
        };

        paletteColumns.forEach((column) => {
          const columnSection = document.createElement("section");
          columnSection.className = `palette-column palette-column--${column.key}`;
          columnSection.dataset.label = column.key;

          const header = document.createElement("div");
          header.className = "palette-column-header";
          header.innerHTML = `
            <div>
              <h2 class="palette-column-title">${column.title}</h2>
              <p class="palette-column-caption">${column.caption}</p>
            </div>
            <span class="palette-column-count">${groups[column.key].length} 件</span>
          `;

          const body = document.createElement("div");
          body.className = "palette-column-body";

          if (groups[column.key].length === 0) {
            const empty = document.createElement("p");
            empty.className = "palette-column-empty";
            empty.textContent = "まだ投稿はありません。";
            body.appendChild(empty);
          } else {
            groups[column.key].forEach((entry) => {
              body.appendChild(createIssueCard(entry));
            });
          }

          columnSection.appendChild(header);
          columnSection.appendChild(body);
          issuesGrid.appendChild(columnSection);
        });

        if (groups.other.length) {
          const otherSection = document.createElement("section");
          otherSection.className = "palette-column palette-column--other";
          otherSection.dataset.label = "other";

          const header = document.createElement("div");
          header.className = "palette-column-header";
          header.innerHTML = `
            <div>
              <h2 class="palette-column-title">Other</h2>
              <p class="palette-column-caption">タグ: その他</p>
            </div>
            <span class="palette-column-count">${groups.other.length} 件</span>
          `;

          const body = document.createElement("div");
          body.className = "palette-column-body";

          groups.other.forEach((entry) => {
            body.appendChild(createIssueCard(entry));
          });

          otherSection.appendChild(header);
          otherSection.appendChild(body);
          issuesGrid.appendChild(otherSection);
        }
      };

      const fetchIssues = async () => {
        statusBar.textContent = "読み込み中...";
        statusBar.style.color = "";
        try {
          const response = await fetch(
            `https://api.github.com/repos/${repoOwner}/${repoName}/issues?state=all&per_page=30&sort=created&direction=desc`
          );

          if (!response.ok) {
            throw new Error(
              `GitHub API の呼び出しに失敗しました (${response.status})`
            );
          }

          const data = await response.json();
          renderIssues(data);
          statusBar.textContent = `最新 ${data.length} 件を表示中`;
        } catch (error) {
          clearIssues();
          emptyState.hidden = true;
          statusBar.textContent = "読み込みに失敗しました。時間をおいて再度お試しください。";
          statusBar.style.color = "#d9534f";
          console.error(error);
        }
      };

      refreshButton.addEventListener("click", () => {
        fetchIssues();
      });

      document.addEventListener("DOMContentLoaded", () => {
        fetchIssues();
      });
    </script>
  </body>
</html>
